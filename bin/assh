#!/usr/bin/env python

import os
import sys
import yaml
import autossh

config_file = os.path.expanduser("~/.config/autossh/config.yaml")

if len(sys.argv) < 2:
    print ""
    print "Usage:" 
    print "  assh [target]"
    print ""
    sys.exit(0)

target = sys.argv[1]

## Load configure file
f = open(config_file)
c = yaml.load(f)
f.close()

hl = autossh.hostlookup.HostLookup()
ok, n = hl.loadFromFile(os.path.expanduser(c["hosts"]["file"]))
if not ok:
    print "[Warning] Load host entry file", c["hosts"]["file"], "fail. You can touch one."

ok, info = hl.get(target)
if not ok:
    print "Target not found: '%s' "%(target) 
    sys.exit(1)

s = autossh.autossh.AutoSSH()
ok, msg = s.login(info)
if not ok:
    print "Login to", target, "fail. Error:", msg
    sys.exit(1)
s.autowinsize()
s.interact()
