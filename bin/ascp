#!/usr/bin/env python

import os
import sys
import autossh
import autossh.autossh
import autossh.hostlookup
import autossh.default

if len(sys.argv) < 4:
    print ""
    print "Usage:"
    print "  ascp [target] [src] [dst]"
    print ""
    sys.exit(0)

target = sys.argv[1]
src = sys.argv[2]
dst = sys.argv[3]

hl = autossh.hostlookup.HostLookup()
ok, n = hl.loadFromFile(autossh.default.host_entry_file)
if not ok:
    print "[Warning] Load host entry file", autossh.default.host_entry_file, "fail. You can touch one."

ok, info = hl.get(target)
if not ok:
    print "Target '%s' not found"%(target) 
    sys.exit(1)

s = autossh.autossh.AutoSSH()
ok, msg = s.scp(info, src, dst)
if not ok:
    print "Scp to", info, "fail. Error", msg
    sys.exit(1)
s.close()
